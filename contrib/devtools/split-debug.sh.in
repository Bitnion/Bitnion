#!/usr/bin/env bash
#
# Bitnion Core - Debug Symbol Split Script Template (Autotools version)
# This script is processed by ./configure to produce split-debug.sh
# It separates debug symbols from release binaries and stores them in a designated debug directory.

set -e

TOPDIR="@abs_top_srcdir@"
OUTDIR="@DEBUG_SYMBOLS_DIR@"

mkdir -p "$OUTDIR"

BINARIES=(
  "bitniond"
  "bitnion-cli"
  "bitnion-tx"
  "qt/bitnion-qt"
)

for BIN in "${BINARIES[@]}"; do
  BIN_PATH="$TOPDIR/src/$BIN"

  if [ ! -f "$BIN_PATH" ]; then
    echo "‚ö†Ô∏è  Skipping missing binary: $BIN_PATH"
    continue
  fi

  DBG_FILE="$OUTDIR/$(basename "$BIN").dbg"

  echo "üîß Processing: $BIN_PATH"
  objcopy --only-keep-debug "$BIN_PATH" "$DBG_FILE"
  strip --strip-debug --strip-unneeded "$BIN_PATH"
  objcopy --add-gnu-debuglink="$DBG_FILE" "$BIN_PATH"

  echo "‚úîÔ∏è  Debug symbols extracted: $DBG_FILE"
done

echo "‚úÖ Bitnion debug symbol split completed."

