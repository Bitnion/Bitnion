---
name: "bitnion-win"
enable_cache: true
suites:
  - focal
architectures:
  - amd64
packages:
  - build-essential
  - libtool
  - autotools-dev
  - automake
  - pkg-config
  - libssl-dev
  - libevent-dev
  - bsdmainutils
  - python3
  - nsis
  - g++-mingw-w64-x86-64
  - wine
  - curl
  - git
  - zip
  - unzip

reference_datetime: "2025-01-01 00:00:00"

remotes:
  - url: https://github.com/bitnion/bitnion.git
    dir: bitnion

files: []

script: |
  set -e

  echo "[bitnion-win] Starting deterministic Windows build for Bitnion."

  cd bitnion
  ./autogen.sh

  ./configure --host=x86_64-w64-mingw32 \
              --disable-tests \
              --without-gui \
              --prefix=$PWD/depends/x86_64-w64-mingw32 \
              --enable-static

  echo "[bitnion-win] Configuration completed. Beginning compilation..."

  make -j$(nproc)

  echo "[bitnion-win] Build finished. Copying output files..."

  mkdir -p $OUTDIR/bin
  cp src/bitniond.exe $OUTDIR/bin/
  cp src/bitnion-cli.exe $OUTDIR/bin/
  cp src/bitnion-tx.exe $OUTDIR/bin/

  echo "[bitnion-win] Final output binaries:"
  ls -lh $OUTDIR/bin/

  echo "[bitnion-win] Bitnion Windows Gitian build completed successfully."
