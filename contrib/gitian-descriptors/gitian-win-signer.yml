---
name: "bitnion-win-signer"
enable_cache: true
suites:
  - focal
architectures:
  - amd64
packages:
  - gpg
  - zip
  - unzip
  - python3

reference_datetime: "2025-01-01 00:00:00"

remotes:
  - url: https://github.com/bitnion/bitnion.git
    dir: bitnion

files: []

script: |
  set -e

  echo "[bitnion-win-signer] Starting Windows binary signing process for Bitnion."

  cd inputs/bitnion
  version=$(cat version.txt)
  echo "[bitnion-win-signer] Signing binaries for version: \$version"

  mkdir -p signed
  for file in bitnion-${version}-win64-setup.exe bitnion-${version}-win64.zip; do
    if [ -f "\$file" ]; then
      echo "[bitnion-win-signer] Signing \$file..."
      gpg --output signed/\$file.sig --detach-sig \$file
      echo "[bitnion-win-signer] Signed: \$file.sig"
    else
      echo "[bitnion-win-signer] Warning: File not found: \$file"
    fi
  done

  echo "[bitnion-win-signer] Zipping signed files..."
  cd signed
  zip ../bitnion-${version}-win-signed.zip *
  cd ..

  mkdir -p \$OUTDIR
  mv bitnion-${version}-win-signed.zip \$OUTDIR/

  echo "[bitnion-win-signer] Signing complete. Output file:"
  ls -lh \$OUTDIR/bitnion-${version}-win-signed.zip

  echo "[bitnion-win-signer] Bitnion Windows binaries signed successfully."
