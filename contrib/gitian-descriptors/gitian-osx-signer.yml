---
name: "bitnion-osx-signer"
enable_cache: true
suites:
  - focal
architectures:
  - amd64
packages:
  - gpg
  - zip
  - unzip
  - python3

reference_datetime: "2025-01-01 00:00:00"

remotes:
  - url: https://github.com/bitnion/bitnion.git
    dir: bitnion

files: []

script: |
  set -e

  echo "[bitnion-osx-signer] Initializing macOS binary signing process for Bitnion."

  cd inputs/bitnion
  version=$(cat version.txt)
  echo "[bitnion-osx-signer] Signing binaries for Bitnion version: \$version"

  mkdir -p signed
  for file in bitnion-${version}-osx.dmg bitnion-${version}-osx.tar.gz; do
    if [ -f "\$file" ]; then
      echo "[bitnion-osx-signer] Signing \$file..."
      gpg --output signed/\$file.sig --detach-sig \$file
      echo "[bitnion-osx-signer] Signed: \$file.sig"
    else
      echo "[bitnion-osx-signer] Warning: File not found: \$file"
    fi
  done

  echo "[bitnion-osx-signer] Creating final archive..."
  cd signed
  zip ../bitnion-${version}-osx-signed.zip *
  cd ..

  mkdir -p \$OUTDIR
  mv bitnion-${version}-osx-signed.zip \$OUTDIR/

  echo "[bitnion-osx-signer] Signing complete. Final output:"
  ls -lh \$OUTDIR/bitnion-${version}-osx-signed.zip

  echo "[bitnion-osx-signer] macOS binaries successfully signed for Bitnion."
