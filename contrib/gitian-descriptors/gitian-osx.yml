---
name: "bitnion-osx"
enable_cache: true
suites:
  - focal
architectures:
  - amd64
packages:
  - cmake
  - pkg-config
  - qtbase5-dev
  - qttools5-dev-tools
  - libprotobuf-dev
  - protobuf-compiler
  - libqrencode-dev
  - libboost-all-dev
  - libssl-dev
  - libevent-dev
  - libminiupnpc-dev
  - libdb-dev
  - libdb++-dev
  - libz-dev
  - libcap-dev
  - git
  - curl
  - automake
  - bsdmainutils
  - build-essential
  - clang
  - libtool
  - autotools-dev
  - autoconf
  - unzip

reference_datetime: "2025-01-01 00:00:00"
remotes:
  - url: https://github.com/bitnion/bitnion.git
    dir: bitnion

files:
  - "osx-sdk.tar.gz"

script: |
  set -e
  export PATH="/opt/osx-sdk/bin:$PATH"
  export SDK_PATH=/opt/osx-sdk/MacOSX10.11.sdk
  export OSX_SDK_VERSION=10.11
  export DEVELOPER_DIR=/opt/osx-sdk

  echo "[bitnion-osx] Begin macOS Gitian build for Bitnion"

  cd bitnion
  ./autogen.sh
  ./configure --prefix=$PWD/depends/x86_64-apple-darwin14 --enable-gui=qt5 --with-gui=qt5 --disable-tests --with-osx-sdk=$SDK_PATH
  make -j$(nproc)

  echo "[bitnion-osx] Build finished. Output binaries placed in 'bitnion/src' and 'bitnion/src/qt'"

  mkdir -p $OUTDIR/bin
  cp src/bitniond $OUTDIR/bin/
  cp src/qt/bitnion-qt $OUTDIR/bin/
  echo "[bitnion-osx] Copied final binaries to output directory."

  echo "[bitnion-osx] Build complete for Bitnion macOS target."
