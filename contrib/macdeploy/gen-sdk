#!/usr/bin/env bash
#
# gen-sdk — Bitnion macOS SDK Preparation Script
#
# This script prepares and copies the required macOS SDK
# for cross-compiling Bitnion Core on non-macOS hosts.
#
# License: MIT
# Adapted from Bitcoin Core's macOS SDK generator
#

set -e

SDK_SOURCE_DIR=${1:-/tmp/MacOSX10.11.sdk}
SDK_DEST_DIR=$(pwd)/sdk/MacOSX10.11.sdk

echo "[*] Preparing Bitnion macOS SDK..."

if [ ! -d "$SDK_SOURCE_DIR" ]; then
    echo "[!] Error: Source SDK directory not found: $SDK_SOURCE_DIR"
    echo "    Please extract it first using extract-osx-sdk.sh"
    exit 1
fi

mkdir -p "$(dirname "$SDK_DEST_DIR")"

echo "[+] Copying SDK from: $SDK_SOURCE_DIR"
cp -a "$SDK_SOURCE_DIR" "$SDK_DEST_DIR"

echo "[✓] SDK successfully copied to:"
echo "    $SDK_DEST_DIR"
echo
echo "You can now build Bitnion Core using this SDK with depends or osxcross."
